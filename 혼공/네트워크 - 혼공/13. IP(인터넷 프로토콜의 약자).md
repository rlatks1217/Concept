### IP
- 물리 계층과 데이터 링크 계층의 한계를 극복하는 프로토콜
- IPv4과 IPv6이 있음
- IPv4가 주로 사용됨

### IP의 공식적인 두 기능
- 주소 지정(IP addressing)
- 단편화(IP fragmentation)

![](../../README_resources/Pasted%20image%2020250615172339.png)

##### 주소지정
- IP주소를 사용하여 특정 네트워크에 속한 **특정 호스트**를 지칭할 수 있음
- IP 주소(IPv4 주소)를 바탕으로 송수신 대상을 지정하는 것을 의미
- 4바이트(32비트)로 하나의 주소로 표현
- 각 숫자를 8비트로 표현 : 0 ~ 255 범위 안에 있는 네 개의 10진수로 표기
- 각 숫자는 점(.)으로 구분
	- 점으로 구분된 8비트(0 ~ 255 범위의 10진수)를 옥텟이라고 함

![](../../README_resources/Pasted%20image%2020250615172606.png)

##### 단편화
- 전송하고자 하는 데이터의 크기가 너무 클 경우, 패킷을 여러 개로 쪼개서 보내는 것을 단편화라고 함 -> 정확히는 패킷이 MTU보다 더 클 경우 MTU보다 작은 여러 개의 패킷으로 쪼개서 보내는 것임 (전송 계층에서 쪼개는 것과는 다른 쪼개기)
- MTU(Maximum Transmission Unit) : 한 번에 전송 가능한 IP 패킷의 최대 크기
- IP 패킷의 헤더도 MTU에 포함됨
- 일반적으로 MTU의 크기는 1500바이트 정도임
- MTU보다 작은 크기로 나눠진 패킷은 수신지에 도착하면 재조합됨

![](../../README_resources/Pasted%20image%2020250615173313.png)

![](../../README_resources/Pasted%20image%2020250615173358.png)

1. 식별자
	- 패킷에 할당된 고유한 번호
	- 쪼개져서 도착한 IPv4 패킷들이 어떤 메시지에서 쪼개졌는지를 알기 위해 사용함
	-> 하나의 메시지가 쪼개져서 생긴 IPv4 패킷들(쪼개진 애들)은 같은 식별자를 공유함
2. 플래그(flag) : 세 개의 비트로 구성
	- 첫 번째 비트는 항상 0으로 현재 사용되지 않음
	- DF(Don't Fragment) 비트 : IP 단편화를 수행하지 말라는 표시(1이면 IP 단편화를 수행하지 말라는 의미 / 0이라면 IP단편화가 가능함을 의미)
	- MF(More Fragment) : 단편화 패킷이 더 있는지를 나타냄(1이라면 아직 도착하지 않은 쪼개진 패킷이 더 있음을 의미 / 0이라면 이 패킷이 쪼개진 패킷들 중 마지막 패킷임을 의미)

![](../../README_resources/Pasted%20image%2020250615173614.png)

3. 단편화 오프셋 (fragment offset)
	- 초기 데이터에서 몇 번째로 떨어진 패킷인지를 나타냄
		- 단편화되어 전송되는 패킷들은 수신지에 순서대로 도착하지 않을 수도 잇음
		- 수신지에서 패킷들을 순서대로 재조합하려면 단편화된 패킷들이 **초기 패킷으로부터 몇 번째에 해당하는 패킷**인지 알아야 함(퍼즐처럼 어느 자리에 들어가야 될 조각인지를 나타내는 값이라고 할 수 있음)

![](../../README_resources/Pasted%20image%2020250615173741.png)

위 3개가 단편화와 관련된 필드들임(이 3개에 의해서 단편화가 이루어짐)

4. TTL (Time To Live)
	- 패킷의 수명
	- 무의미한 패킷이 네트워크 상에 지속적으로 남아있는 것을 방지하기 위해 존재
	- 패킷이 하나의 라우터를 거칠 때마다 TTL이 1씩 감소, TTL 값이 0으로 떨어진 패킷은 폐기
	- 홉(hop) : 패킷이 호스트 또는 라우터에 한 번 전달되는 것을 의미
		- 즉, TTL 필드의 값은 홉마다 1씩 감소하게 됨

![](../../README_resources/Pasted%20image%2020250615173940.png)

5. 프로토콜
	- 상위 계층의 프로토콜이 무엇인지 나타내는 필드(이더넷 프레임의 타입/길이와 마찬가지)
	예) 전송 계층의 대표적인 프로토콜인 TCP는 6번, UDP는 17번으로 나타냄
6. 송신지 IP 주소, 수신지 IP 주소
	- 이름 그대로 송수신지의 주소
	- 주소 지정에 관여하는 필드

### IPv6
- 이론적으로 할당 가능한 IPv4 주소 갯수는 몇 개인가? 약 43억개
- 43억개는 충분하지 않음(전 세계 인구가 1개씩만 IP주소를 갖는다고 가정해도 이미 부족함)
- 부족한 IP주소 갯수 때문에 나온 게 IPv6
- IPv6는 16바이트(128비트)로 주소를 표현할 수 있고, 콜론(:)으로 구분된 8개 그룹의 16진수로 표기
- 이론적으로 할당 가능한 IPv6 주소는 **2의 128제곱**개(사실상 무한에 가까운 수만큼 할당 가능)

1840

1. 다음 헤더 (next header)
	- 상위 계층의 프로토콜 또는 확장 헤더를 가리키는 필드
	- 확장 헤더
		- IPv6는 기본 헤더와 더불어 확장 헤더(extension header)라는 추가 헤더를 가질 수 있음
		- 확장 헤더는 기본 헤더와 페이로드 데이터 사이에 위치
		- 마치 꼬리에 꼬리를 물 듯 또 다른 확장 헤더를 가질 수도 있음

1930

### IPv6의 단편화
- IPv6는 단편화 확장 헤더를 통해 단편화가 이루어짐
- 단편화 확장 헤더에도 다음 헤더 필드가 있음
	- 예약됨(reserved)와 예약(res) 필드는 0으로 설정되어 사용되지 않음
	- 단편화 오프셋(fragment offset)과 M 플래그(M flag), 식별자(Identification) 필드
	- M 플래그는 1일 경우 더 많은 단편화딘 패킷이 있음을, 0일 경우 마지막 패킷임을 나타냄(IPv4의 MF 플래그 필드)
	- 식별자는 동일한 메시지에서부터 단편화된 패킷임을 나타내는 필드(IPv4의 MF 식별자 필드)

2200

이외에 IPv6의 필드
- 홉 제한 : IPv4 패킷의 TTL 필드와 비슷한 패킷의 수명을 나타내는 필드
- 송신지 IP 주소, 수신지 IP 주소 : IPv6 주소를 가지고 송수신지 지정









